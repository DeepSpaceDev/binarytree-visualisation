<dom-module id="binary-node">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        box-sizing: border-box;
      }
    </style>
    <canvas id="node" width="50" height="50"></canvas>
  </template>
  <script>
    Polymer({
      is: 'binary-node',

      properties: {
        value: {
          observer: 'valueChanged',
          value: ''
        },
        left: {
          type: Boolean,
          value: false
        },
        right: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'click': '_handleClick'
      },

      valueChanged: function(value) {
        this.repaint();
      },

      _handleClick: function (e) {
        var x = e.offsetX;
        var y = e.offsetY;

        var leftXMin = 6;
        var leftXMax = 16;
        var rightXMin = 34;
        var rightXMax = 44;

        var yMin = 34;
        var yMax = 44;

        if(y > yMin && y < yMax) {
          if(x > leftXMin && x < leftXMax && !this.left) {
            this.fire('addChild', {
              right: false,
              left: true
            });
          }
          if(x > rightXMin && x < rightXMax  && !this.right) {
            this.fire('addChild', {
              right: true,
              left: false
            });
          }
        }
      },

      attached: function () {
        this.repaint();
      },

      repaint: function() {
        var canvas = this.$.node;
        var ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.beginPath();
        ctx.arc(25, 25, 15, 0, 2 * Math.PI, false);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(11, 39, 5, 0, 2 * Math.PI, false);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(39, 39, 5, 0, 2 * Math.PI, false);
        ctx.stroke();

        if(this.value && this.value !== '')
          ctx.strokeText(this.value, 22, 28);
      }
    });
  </script>
</dom-module>
